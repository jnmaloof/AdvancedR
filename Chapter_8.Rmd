---
title: "Chapter 8"
author: "Julin Maloof"
date: "2022-11-01"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(rlang)
```

## 8.2.4 Exercises

### 1. Write a wrapper around file.remove() that throws an error if the file to be deleted does not exist.

```{r, error=TRUE}

file.remove2 <- function(...) {
  for(f in list(...)) 
      if(!file.exists(f)) abort(paste0("File '", f, "' does not exist!"))
  file.remove(...)
}


file.create("chapter8testfile.txt")

file.remove2("chapter8testfile.txt")

file.create("chapter8testfile2.txt")

file.remove2("chapter8testfile2.txt", "a")

file.remove2("chapter8testfile2.txt")

```


### 2. What does the appendLF argument to message() do? How is it related to cat()

_adds a newline.  cat() does not do this_

## 8.4.5 Exercises

### 1. What extra information does the condition generated by abort() contain compared to the condition generated by stop() i.e. whatâ€™s the difference between these two objects? Read the help for ?abort to learn more.

```{r}
str(catch_cnd(stop("An error")))

str(catch_cnd(abort("An error")))
```
_`abort` shows the backtrace, assigns a class, and has additional data_ 

### 2. Predict the results of evaluating the following code

```{r}
show_condition <- function(code) {
  tryCatch(
    error = function(cnd) "error",
    warning = function(cnd) "warning",
    message = function(cnd) "message",
    {
      code
      NULL
    }
  )
}

show_condition(stop("!")) # will produce an error message "error" (but not "!")

show_condition(10) # will return NULL

show_condition(warning("?!")) # will return "warning" and then stop because of tryCatch

show_condition({
  10
  message("?")
  warning("?!")
}) #will return "message" and then stop because of tryCatch
```


### 3. Explain the results of running this code:

```{r}
withCallingHandlers(
  message = function(cnd) message("b"),
  withCallingHandlers(
    message = function(cnd) message("a"),
    message("c")
  )
)
#> b
#> a
#> b
#> c
```

_message(c) bubbles up to message("a"); execution of that code causes "b" to get printed.  Then "a" gets printed, and then "c" continues to bubble up up to message("b") and prints b (second time); then finally "c" is printed._
 
### 4. Read the source code for catch_cnd() and explain how it works.

### 5. How could you rewrite show_condition() to use a single handler?

```{r}
show_condition <- function(code) {
  c <- catch_cnd(
    {
      code
    }
  ) 
  if (!is.null(c)) class(c)[2] else NULL
}

show_condition(stop("!")) # will produce an error message "error" (but not "!")

show_condition(10) # will return NULL

show_condition(warning("?!")) # will return "warning" 

show_condition({
  10
  message("?")
  warning("?!")
}) #will return "message" and then stop
```

